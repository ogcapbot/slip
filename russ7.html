<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OG Capper Bets Ticket</title>
  <style>
    body {
      font-family: monospace;
      background: #000;
      color: #00ffcc;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }
    .loader-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .circle-loader {
      position: relative;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: conic-gradient(#00ff99 var(--progress), #333 0);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }
    .circle-loader span {
      position: absolute;
      color: white;
      font-size: 1.5rem;
      font-weight: bold;
    }
    #logBox {
      width: 300px;
      height: 90px;
      border: 2px solid #00ff99;
      padding: 10px;
      overflow-y: auto;
      background: #111;
      color: #ccffff;
      font-size: 0.9rem;
      box-shadow: 0 0 10px #00ff99;
    }
    .hidden {
      display: none;
    }
    .error {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>OG Capper Bets Ticket</h2>
  <div class="loader-container" id="loader">
    <div class="circle-loader" style="--progress: 0%">
      <span id="progressText">0%</span>
    </div>
    <div id="logBox"></div>
  </div>

  <script>
    const progressCircle = document.querySelector(".circle-loader");
    const progressText = document.getElementById("progressText");
    const logBox = document.getElementById("logBox");
    let allTeams = [];

    const log = (message, isError = false) => {
      const line = document.createElement("div");
      line.textContent = message;
      if (isError) line.classList.add("error");
      logBox.appendChild(line);
      logBox.scrollTop = logBox.scrollHeight;
    };

    const updateProgress = (current, total) => {
      const percent = Math.round((current / total) * 100);
      progressCircle.style.setProperty("--progress", `${percent}%`);
      progressText.textContent = `${percent}%`;
    };

    async function loadData() {
      log("• Fetching all sports from SportsDB...");
      const sportsRes = await fetch("https://www.thesportsdb.com/api/v1/json/123/all_sports.php");
      const sportsData = await sportsRes.json();

      const sportsList = sportsData?.sports || [];
      const total = sportsList.length;

      for (let i = 0; i < total; i++) {
        const sport = sportsList[i];
        const sportName = sport.strSport;
        log(`• Fetching teams for: ${sportName}...`);

        try {
          const teamRes = await fetch(`https://www.thesportsdb.com/api/v1/json/123/search_all_teams.php?s=${encodeURIComponent(sportName)}`);
          const teamData = await teamRes.json();

          const teams = teamData?.teams || [];
          teams.forEach(team => {
            if (team.strTeam) {
              allTeams.push({
                name: team.strTeam.toLowerCase(),
                sport: sportName,
                id: team.idTeam
              });
            }
          });
        } catch (e) {
          log(`❌ Failed to load data for ${sportName}`, true);
        }
        updateProgress(i + 1, total);
      }

      log("✔️ Done loading all data.");
    }

    window.onload = () => {
      loadData();
    };
  </script>
</body>
</html>
