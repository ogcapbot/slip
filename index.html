<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OG Capper Bets Slip</title>
  <style>
    body {
      background: #0f0f0f;
      font-family: 'Arial', sans-serif;
      color: #f5f5f5;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      margin-top: 40px;
      width: 90%;
      max-width: 500px;
      background: #1a1a1a;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.05);
    }
    input, select, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
    }
    input, select {
      background: #2a2a2a;
      color: #fff;
    }
    button {
      background: #ff4747;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    .ticket {
      background: #fff;
      color: #000;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    .error {
      color: #ff6b6b;
      margin-top: 12px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>OG Capper Bet Slip</h2>
    <input type="text" id="betInput" placeholder="e.g. Yankees ML 1.5u" />
    <select id="unitValue">
      <option value="100">$100 per unit</option>
      <option value="50">$50 per unit</option>
      <option value="25">$25 per unit</option>
    </select>
    <button onclick="generateSlip()">Generate Ticket</button>
    <div class="error" id="error"></div>
    <div class="ticket" id="ticketOutput"></div>
  </div>
  <script>
    const apiKey = "5b3cb0e7293b7d6217e6e99fa768fd0b";
    const supportedSports = {
      "baseball_mlb": "Baseball",
      "soccer_epl": "Soccer",
      "soccer_usa_mls": "Soccer",
      "soccer_italy_serie_a": "Soccer",
      "soccer_spain_la_liga": "Soccer",
      "mma_mixed_martial_arts": "MMA",
      "boxing": "Boxing"
    };

    async function generateSlip() {
      const input = document.getElementById("betInput").value.toLowerCase();
      const unitValue = parseFloat(document.getElementById("unitValue").value);
      const errorEl = document.getElementById("error");
      const ticketEl = document.getElementById("ticketOutput");

      errorEl.textContent = "";
      ticketEl.textContent = "";

      const match = input.match(/(.+?)\s+(ml|moneyline)\s+(\d+(\.\d+)?)u/);
      if (!match) {
        errorEl.textContent = "Could not parse your input. Try 'Yankees ML 1.5u'.";
        return;
      }

      const query = match[1].trim();
      const units = parseFloat(match[3]);
      const wager = units * unitValue;

      let matched = null;

      for (let sport in supportedSports) {
        const res = await fetch(`https://api.the-odds-api.com/v4/sports/${sport}/odds/?apiKey=${apiKey}&regions=us&markets=h2h&oddsFormat=american`);
        const games = await res.json();

        for (let game of games) {
          const teams = [game.home_team.toLowerCase(), game.away_team.toLowerCase()];
          const teamMatch = teams.find(t => t.includes(query));
          if (teamMatch) {
            const isHome = teamMatch === game.home_team.toLowerCase();
            const odds = game.bookmakers?.[0]?.markets?.[0]?.outcomes.find(o => o.name.toLowerCase().includes(query));
            const opponent = isHome ? game.away_team : game.home_team;
            const line = odds ? odds.price : "-110";
            const sportName = supportedSports[sport];
            const kickoff = new Date(game.commence_time);
            const timeStr = kickoff.toLocaleTimeString("en-US", { hour: "numeric", minute: "2-digit" });

            const buzzword = units >= 2 ? "ðŸ”¥ SHARP MOVE" : units >= 1 ? "ðŸ’° Smart Play" : "ðŸŽ¯ Target Shot";
            const headline = `${new Date().toLocaleDateString()} â€“ $${wager.toFixed(2)} ${buzzword} â€“ ${sportName} â€“ Starts @ ${timeStr}`;

            ticketEl.textContent = `${headline}
-------------------------------
OG Capper Bets
Bet Type: MONEYLINE
Wager: ${units}u ($${wager.toFixed(2)})
Team: ${teamMatch.toUpperCase()}
Opponent: ${opponent.toUpperCase()}
Odds: ${line}
Kickoff: ${kickoff.toLocaleString()}
-------------------------------
Status: UPCOMING`;
            return;
          }
        }
      }
      errorEl.textContent = `Game not found. Double check your input. If this keeps happening, send us a screenshot.`;
    }
  </script>
</body>
</html>
