<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>

  <link href="https://fonts.googleapis.com/css2?family=Oswald&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Oswald', sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
    }
    .container {
      width: 100%;
      max-width: 400px;
      padding: 20px;
    }
    input[type="number"],
    input[type="text"],
    select,
    textarea {
      width: 100%;
      max-width: 400px;
      box-sizing: border-box;
      margin: 0 auto 12px;
      display: block;
      padding: 12px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      width: 100%;
      max-width: 400px;
      box-sizing: border-box;
      margin: 0 auto 12px;
      display: block;
      padding: 12px;
      font-size: 16px;
      background-color: #2a9fd6;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background-color: #2179a5;
    }
    .hidden {
      display: none;
    }
    .error {
      color: red;
      font-size: 14px;
      margin-top: 10px;
    }
    #loader {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #2a9fd6;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    #confirmOutput {
      white-space: pre-wrap;
      font-family: monospace;
      background: #fff;
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 6px;
      margin-top: 10px;
      resize: none;
      overflow: hidden;
      min-height: 200px;
      height: auto;
    }
    #resetWrapper {
      position: relative;
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
      height: 0;
    }
    #resetBtn {
      position: absolute;
      top: -35px;
      right: 0;
      font-size: 14px;
      padding: 4px 12px;
      background-color: #2a9fd6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      height: auto;
      width: auto;
      white-space: nowrap;
    }
    #copyBtn {
      margin-bottom: 10px;
    }
    #loginNotice {
      margin-bottom: 20px;
      font-weight: bold;
    }
    #inputLabel {
      color: #666;
      font-size: 14px;
      margin-bottom: 5px;
    }
    #gameSuggestion {
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 15px;
      background: #fff;
      margin-bottom: 20px;
      width: 100%;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
      box-sizing: border-box;
    }
    #gameSuggestion p {
      margin: 6px 0;
    }
    #gameSuggestion strong {
      display: block;
      margin-bottom: 10px;
      font-size: 16px;
    }
    #gameTable,
    #sportDropdown {
      display: none;
    }
    #sports-screen {
      position: relative;
      overflow: hidden;
    }
    #imageLoader {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #2a9fd6;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    #imageLoaderText {
      font-size: 16px;
      font-weight: bold;
      color: #2a9fd6;
      animation: blink 1.5s infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.2; }
    }
    /* Highlight for selected hype phrase */
    .hypePhraseResult:focus {
      outline: 2px solid #2a9fd6;
    }
  </style>
</head>
<body>
  <div class="container" id="access-screen">
    <div id="globalHeader" style="text-align: center; padding: 20px 0 10px;">
      <h3 style="margin: 0;">OG Capper Bets ‚Äì Official Pick Image Creator v7.25</h3>
      <h5 style="margin: 0; color: red;">Official Use Only</h5>
    </div>

    <label style="color: #666; font-size: 14px; margin-bottom: 10px; display: block;">Enter Access Code</label>
    <input type="text" id="accessCode" placeholder="Enter Code Here" pattern="[0-9]*" inputmode="numeric" maxlength="10" style="width: 100%; max-width: 400px; box-sizing: border-box; display: block; margin: 0 auto 12px; padding: 12px; font-size: 16px; border-radius: 6px; border: 1px solid #ccc;" />
    <button id="accessBtn" onclick="validateAccess()">Submit</button>
    <div class="error" id="error"></div>
  </div>

  <div class="container hidden" id="sports-screen">
    <div id="loader"></div>
    <div id="loadingMsg" style="text-align:center; font-weight:bold;">Loading Games...</div>

    <div id="loggedInInfo" class="hidden">
      <div id="globalHeader" style="text-align: center; padding: 20px 0 10px;">
        <h3 style="margin: 0;">OG Capper Bets ‚Äì Official Pick Image Creator v7.25</h3>
        <h5 style="margin: 0; color: red;">Official Use Only</h5>
        <h5 id="loginNotice" style="margin: 0; color: gray;"></h5>
      </div>

      <div id="resetWrapper">
        <button id="resetBtn" onclick="resetSearch()">Reset</button>
      </div>

      <div id="gameSuggestion" class="hidden"></div>

      <div id="inputLabel">Enter Team Name: (e.g. 'Chicago Cubs' or 'Cubs')</div>
      <input type="text" id="teamSearch" placeholder="Must be at least 3 Characters" />
      <button id="searchBtn" onclick="searchGames()">Submit</button>
      <div class="error" id="searchError"></div>

      <div id="customInputSection" class="hidden">
        <label for="wagerType" style="color: #666; font-size: 14px; margin-bottom: 5px; display: block;">
          Enter Wager Type (e.g. 'ML' or 'F5' or 'TT OVER 5')
        </label>
        <input type="text" id="wagerType" />
        <button onclick="submitWagerType()">Submit</button>
        <div class="error" id="wagerError"></div>
      </div>

      <div id="unitDropdownSection" class="hidden">
        <label for="unitDropdown" style="color:#666;font-size:14px;margin-bottom:5px;display:block;">
          Select Unit(s):
        </label>
        <select id="unitDropdown"></select>
        <div class="error" id="unitDropdownError"></div>
      </div>

      <div id="notesChoiceSection" class="hidden">
        <label style="color: #666; font-size: 14px; margin-bottom: 10px; display: block;">
          Do You Want to Include any Comments/Notes?
        </label>
        <button id="yesNoteBtn">Yes, Enter Comment/Note</button>
        <button id="noNoteBtn">No, Proceed to Image Creation</button>
      </div>

      <div id="notesInputSection" class="hidden" style="margin-top: 20px;">
        <div id="notesHeaderRow" style="display: none; justify-content: space-between; align-items: center; margin-bottom: 5px;">
          <label for="notesInput" style="color: #666; font-size: 14px;">
            Enter Your Comment/Note Below:
          </label>
          <div id="charCount" style="color: #666; font-size: 14px;">
            Remaining: 100
          </div>
        </div>
        <textarea id="notesInput" rows="2" maxlength="100" placeholder="Enter Comment/Note Here" style="font-family: 'Oswald', Arial, sans-serif; font-size: 14px; width: 100%; box-sizing: border-box;"></textarea>
        <button id="submitNoteBtn" class="hidden">Submit</button>
      </div>

      <pre id="confirmOutput" class="hidden" style="white-space:pre-wrap; word-wrap:break-word; background:#fff; border:1px solid #ccc; padding:15px; border-radius:6px; margin-top:10px; min-height:200px;"></pre>

    </div>
  </div>

  <!-- === NEW HYPE PHRASE SECTION ADDED HERE === -->
  <div class="container hidden" id="hypePhraseSection" style="margin-top: 20px;">
    <label for="hypePhraseDropdown" style="color:#666; font-size:14px; margin-bottom:5px; display:block;">
      Select Hype Phrase Category:
    </label>
    <select id="hypePhraseDropdown">
      <option selected disabled>Select a Category</option>
    </select>

    <label for="hypePhraseSubDropdown" style="color:#666; font-size:14px; margin-bottom:5px; display:block; margin-top: 15px;" class="hidden">
      Select Phrase:
    </label>
    <select id="hypePhraseSubDropdown" class="hidden">
      <option selected disabled>Select a Phrase</option>
    </select>

    <div id="hypePhraseResults" style="margin-top: 20px;"></div>

    <button id="proceedFromHypeBtn" class="hidden" style="margin-top: 20px;">Proceed to Image Creation</button>
  </div>

  <script>
    const BASE_URL = "https://script.google.com/macros/s/AKfycbzbNo6fcQsDvPSlsaC9y1U3NsO214vuS-7a6EwhtFXi-sH3fHQaJawg6LDehcf4TCepkA/exec";
    let capperInfo = [], allData = {}, currentMatchIndex = 0, matches = [], selectedMatch = null, capperName = "";

    window.onload = async () => {
      try {
        const res = await fetch(BASE_URL + "?action=capperOnly");
        const result = await res.json();
        capperInfo = result.capperInfo;
        document.getElementById("accessCode").disabled = false;
        document.getElementById("accessBtn").disabled = false;
        document.getElementById("accessCode").focus();
      } catch {
        document.getElementById("error").textContent = "Failed to load access codes.";
      }
    };

    function validateAccess() {
      const code = document.getElementById("accessCode").value.trim();
      const match = capperInfo.find(row => row["Access Code"] == code);
      if (code.length < 4 || code.length > 10 || !match) {
        document.getElementById("error").textContent = "Access Code Invalid. Please Enter a Valid Access Code.";
        return;
      }
      capperName = match["Display Name"];
      document.getElementById("access-screen").classList.add("hidden");
      document.getElementById("sports-screen").classList.remove("hidden");

      // üîΩ Hide all children of sports-screen except loader and loadingMsg
      Array.from(document.querySelectorAll("#sports-screen > *"))
        .forEach(el => {
          if (el.id !== "loader" && el.id !== "loadingMsg") {
            el.style.display = "none";
          }
        });

      loadAllData();
    }

    document.getElementById("accessCode").addEventListener("input", (e) => {
      e.target.value = e.target.value.replace(/\D/g, "");
      if (e.target.value.length > 10) {
        e.target.value = e.target.value.slice(0, 10);
      }
    });

    async function loadAllData() {
      try {
        const res = await fetch(BASE_URL + "?action=data");
        allData = await res.json();
        console.log("Loaded allData:", allData);
        console.log("Units data:", allData.units);

        // Hide loader and message
        document.getElementById("loader").style.display = "none";
        document.getElementById("loadingMsg").style.display = "none";

        // Show all other elements again (excluding loader and loadingMsg)
        Array.from(document.querySelectorAll("#sports-screen > *"))
          .forEach(el => {
            if (el.id !== "loader" && el.id !== "loadingMsg") {
              el.style.display = "";
            }
          });

        console.log("Wagers Data:", allData.wagers);

        document.getElementById("loggedInInfo").classList.remove("hidden");
        document.getElementById("teamSearch").focus();
        document.getElementById("loginNotice").textContent = `Logged in as: ${capperName}`;

      } catch {
        alert("Failed to load sports data.");
      }
    }

    // ... (Your existing code for teamSearch, searchGames, showGameOption, nextOption, useThisGame, submitWagerType, submitUnitAmount, etc. unchanged)

    // --- NEW CODE FOR HYPE PHRASES ---

    let selectedHypePhraseTitle = "";

    function showHypePhraseSection() {
      document.getElementById("notesChoiceSection").classList.add("hidden");
      document.getElementById("notesInputSection").classList.add("hidden");

      // Show new section
      const hypeSection = document.getElementById("hypePhraseSection");
      hypeSection.classList.remove("hidden");

      buildHypePhraseDropdown();
    }

    function buildHypePhraseDropdown() {
      const dropdown = document.getElementById("hypePhraseDropdown");
      dropdown.innerHTML = `<option selected disabled>Select a Category</option>`;

      if (!allData.hypePhrases) return;

      const uniqueCategories = [...new Set(allData.hypePhrases.map(row => row["Column A"] || row["Category"] || "").filter(x => x))];

      uniqueCategories.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        dropdown.appendChild(option);
      });

      resetHypePhraseSubDropdown();
      clearHypePhraseResults();

      dropdown.onchange = () => {
        const selectedCategory = dropdown.value;
        populateHypePhraseSubDropdown(selectedCategory);
      };
    }

    function resetHypePhraseSubDropdown() {
      const subDropdown = document.getElementById("hypePhraseSubDropdown");
      const label = document.querySelector('label[for="hypePhraseSubDropdown"]');
      subDropdown.innerHTML = `<option selected disabled>Select a Phrase</option>`;
      subDropdown.classList.add("hidden");
      label.classList.add("hidden");
    }

    function clearHypePhraseResults() {
      document.getElementById("hypePhraseResults").innerHTML = "";
      document.getElementById("proceedFromHypeBtn").classList.add("hidden");
      selectedHypePhraseTitle = "";
    }

    function populateHypePhraseSubDropdown(selectedCategory) {
      const subDropdown = document.getElementById("hypePhraseSubDropdown");
      const label = document.querySelector('label[for="hypePhraseSubDropdown"]');
      subDropdown.innerHTML = `<option selected disabled>Select a Phrase</option>`;

      const filteredRows = allData.hypePhrases.filter(row => (row["Column A"] || row["Category"]) === selectedCategory);

      filteredRows.forEach(row => {
        const phrase = row["Column B"] || row["Phrase"] || "";
        if (phrase) {
          const option = document.createElement("option");
          option.value = phrase;
          option.textContent = phrase;
          subDropdown.appendChild(option);
        }
      });

      if (filteredRows.length > 0) {
        subDropdown.classList.remove("hidden");
        label.classList.remove("hidden");
      } else {
        subDropdown.classList.add("hidden");
        label.classList.add("hidden");
      }

      clearHypePhraseResults();

      subDropdown.onchange = () => {
        const selectedPhrase = subDropdown.value;
        showHypePhraseResults(selectedCategory, selectedPhrase);
      };
    }

    function showHypePhraseResults(selectedCategory, selectedPhrase) {
      const resultsDiv = document.getElementById("hypePhraseResults");
      const proceedBtn = document.getElementById("proceedFromHypeBtn");

      let matchedRows = allData.hypePhrases.filter(row => {
        const cat = row["Column A"] || row["Category"] || "";
        const phrase = row["Column B"] || row["Phrase"] || "";
        return cat === selectedCategory && phrase === selectedPhrase;
      });

      if (matchedRows.length === 0) {
        resultsDiv.innerHTML = "<p>No matching results found.</p>";
        proceedBtn.classList.add("hidden");
        selectedHypePhraseTitle = "";
        return;
      }

      matchedRows = matchedRows.sort(() => Math.random() - 0.5);

      let html = "";
      matchedRows.forEach((row, index) => {
        const sport = row["Column C"] || row["Sport"] || "N/A";
        const phrase = row["Column D"] || row["Phrase"] || "";
        const promo = row["Column E"] || row["Promo"] || "";

        html += `
        <div class="hypePhraseResult" tabindex="0" style="border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; cursor: pointer; user-select:none;">
          <strong>Related Sport:</strong> ${sport}<br>
          <strong>Post Title:</strong> [[UNIT]] UNITS - ${phrase} - ${sport} ‚öæÔ∏è - STARTS @ [[GAME TIME HH:MM AM/PM EST]]<br>
          <strong>Post Description:</strong> ${promo}
        </div>
        <hr>
        `;
      });

      resultsDiv.innerHTML = html;

      const resultDivs = resultsDiv.querySelectorAll(".hypePhraseResult");
      resultDivs.forEach((div, idx) => {
        div.onclick = () => {
          selectHypePhrase(matchedRows[idx]);
        };
        div.onkeydown = (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            selectHypePhrase(matchedRows[idx]);
          }
        };
      });

      proceedBtn.classList.remove("hidden");
      proceedBtn.onclick = () => {
        if (selectedHypePhraseTitle) {
          updateTitleForImageCreation(selectedHypePhraseTitle);
          proceedToImageCreationScreen();
        } else {
          alert("Please select a Post Title by clicking a section above.");
        }
      };

      selectedHypePhraseTitle = "";
    }

    function selectHypePhrase(row) {
      const phrase = row["Column D"] || row["Phrase"] || "";
      const sport = row["Column C"] || row["Sport"] || "N/A";

      selectedHypePhraseTitle = `[[UNIT]] UNITS - ${phrase} - ${sport} ‚öæÔ∏è - STARTS @ [[GAME TIME HH:MM AM/PM EST]]`;

      const resultsDiv = document.getElementById("hypePhraseResults");
      resultsDiv.querySelectorAll(".hypePhraseResult").forEach(div => {
        div.style.backgroundColor = "";
      });

      const matchedDivs = [...resultsDiv.children].filter(div => div.classList && div.classList.contains("hypePhraseResult"));
      matchedDivs.forEach((div, i) => {
        if (i === matchedDivs.findIndex(d => d.textContent.includes(phrase))) {
          div.style.backgroundColor = "#d0f0fd";
        }
      });
    }

    function updateTitleForImageCreation(title) {
      // Store selected title globally to be used in image creation screen
      window.selectedTitleForImageCreation = title;

      // If you have a UI element or variable for the [[TITLE]] in image creation,
      // update it here as needed
      // Example: document.getElementById("titlePreview").textContent = title;
    }

    function proceedToImageCreationScreen() {
      // Hide hype phrase section
      document.getElementById("hypePhraseSection").classList.add("hidden");

      // Show image creation screen
      // You need to adjust this according to your existing image creation screen
      // For example, if image creation screen has id="imageCreationScreen":
      // document.getElementById("imageCreationScreen").classList.remove("hidden");

      // If you do not have a specific container, adjust as needed

      // For now, just log as a placeholder:
      console.log("Proceeding to Image Creation Screen with title:", window.selectedTitleForImageCreation);

      // TODO: Insert your actual image creation screen show/hide logic here
    }

    // Hook into note buttons
    document.getElementById("noNoteBtn").addEventListener("click", () => {
      showHypePhraseSection();
    });

    document.getElementById("yesNoteBtn").addEventListener("click", () => {
      document.getElementById("notesChoiceSection").classList.add("hidden");
      document.getElementById("notesInputSection").classList.remove("hidden");
    });

    // ... The rest of your existing code continues unchanged ...

  </script>
</body>
</html>
